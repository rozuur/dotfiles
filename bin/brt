#!/bin/bash

# Bloomreach transfer
# stores files in temporary s3 bucket

set -euo pipefail
IFS=$'\n\t'

declare -r S3_BUCKET='br-tmp'
declare -r S3_BROWSER_PREFIX='https://s3browser.corp.bloomreach.com/data'

function brt {
    if [ $# -ne 1 ]; then
        echo -e "Usage:\nbrt <filename>";
        return 1;
    fi

    local random="$(tr -dc A-Za-z0-9 < /dev/urandom| head -c 10)"
    local s3_loc="s3://${S3_BUCKET}/${USER}/${random}/$(basename $1)"
    s3cmd put "$1" "${s3_loc}" 1>/dev/null \
        && echo "${S3_BROWSER_PREFIX}/${s3_loc}"
}

brt "$@"
